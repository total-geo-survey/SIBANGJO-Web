<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Total Geo Survey">
    <link rel="shortcut icon" href="building.png">
    <title> SIBANGJO </title>

    <!-- Google Font -->
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,500,400italic,300italic,300,500italic,700,700italic,900,900italic'
        rel='stylesheet' type='text/css'>

    <!-- FontAwesome JS -->
	<script defer src="assets/fontawesome/js/all.min.js">
    </script>

    <!-- Global CSS -->
    <link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">   

    <!-- Theme CSS -->  
    <link id="theme-style" rel="stylesheet" href="assets/css/orbit-1.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

    <!-- Bootstrap Library -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" 
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous">
    </script>

   <!-- Jquery Library -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" 
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous">
    </script>

   <!-- Cloudflare Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" 
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous">
    </script>
     
    <!-- Dependencies -->
    <script src="./bundle.js">
    </script>

    <!-- Add Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.1/dist/leaflet.css"
        integrity="sha256-sA+zWATbFveLLNqWO2gtiw3HL/lh1giY/Inf1BJ0z14=" crossorigin=""/>
    <link rel="stylesheet" type="text/css" href="./Leaflet.GraphicScale.min.css">   
    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet@1.9.1/dist/leaflet.js"
        integrity="sha256-NDI0K41gVbWqfkkaHj15IzU7PtMoelkzyKp8TOaFQ3s=" crossorigin="">
    </script>
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js">
    </script>
    <script src="./Leaflet.GraphicScale.min.js">
    </script>
    
    <!-- Add Map -->
    <style>
        html, body, section
        {   position: center;
            height: 100%;
            background-color: white;
        }

        html
        {   scroll-behavior: smooth;
        }

        #map { height: calc(100vh - 56px);
             }
	    
	.legend {
            background-color: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 10px;
	    text-align:left;
        }
	    
        .legend div {
            margin: 5px 0;
        }
	    
	.legend span {
            width: 20px;
            height: 20px;
            display: inline-block;
        }

	.navbar {
            background-color: #fcb712;
            padding: 10px 0;
            display: flex;         
            justify-content: center;
            align-items: center;  
            color: #1c346c;
            font-size: 25px;
            font-weight: bold;
        }

	.navbar img {
            width: 25px;         
            height: 25px;         
            margin-right: 10px;   
        }
    </style>
</head>

<body>
    <!-- Add Navigation Bar -->
    <div class="navbar">
	<img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjqAQvk5IFTE6wBymflqhnmNUCeJ6Lf97pt23hNkQ8Yb9A2x6OzrdrbegU71SBRmcVLEoqxnYRYvyHss1tR3AjZIFfnCM-tnKHbyEwVyR3wYgJmtxFtA1WGj08G72KgS9l9HicE0X5gxmpqtF2A4JQKnE0z7_4IXto3NsTHtnp91w5i7r7r70gyoQ/s320/Logo%20Kementerian%20PUPR%20(PNG-1080p)%20-%20koleksilogo.png" alt="Logo PUPR">
        SIBANGJO: SISTEM INFORMASI BANGUNAN JOGJA
    </div>

    <!-- Add Map GeoJSON -->
    <center>
        <div id="map"></div>
        <script src="Kelurahan.js"></script>
	<script src="jalan_merge.js"></script>
        <script src="bgnv02.js"></script>
    </center>

    <!-- Map Script -->
    <script>
        var map = L.map('map',{
            center: [-7.80329119, 110.37435397],
            zoom: 14,
            zoomControl: true,
            maxZoom: 33,
            minZoom: 1,
	    zoomSnap: 0.5,
            zoomDelta: 0.5
        });

	// Custom Icon Geolocation
	const myCustomIcon = L.icon({
        	iconUrl: './Data/pin.png',
        	iconSize: [30,30]
    	})
	    
	// Geolocation API
    	map.locate({setView:false, zoom: 14})
    	function onLocationFound(e){
        	var radius = e.accuracy.toFixed(2);
        	var locationMarker = L.marker(e.latlng, {icon: myCustomIcon}).addTo(map)
          	    .bindPopup('Anda berada di sekitar ' + radius + ' meter dari titik ini').openPopup()
        	var locationCircle = L.circle(e.latlng, radius).addTo(map);
    	}

    	map.on('locationfound', onLocationFound);
	function onLocationError(e){
        	window.alert(e.message)
    	}	    
    	map.on('locationerror', onLocationError);
	    
        // Basemap Source
	var imageUrl = 'https://p-tok1.pcloud.com/cfZ8sHG13Zirsppb7Z8A397ZZBX17XkZ3VZZWWRZZU23IFZcLZOLZlYZVHZCpZGzZd4ZgRZJ4ZOHZA4ZkzZJ8ZvzZpRAIfkkNNHhRMphDS0RcGk5DIPSy/Base50uncom.png',
            imageBounds = [[-7.7650351972, 110.3410364607], [-7.8418421839, 110.4099212895]];
        var real = L.imageOverlay(imageUrl, imageBounds,{
            attribution: 'WebGIS by &copy; <a href="https://totalgeosurvey.com/">PT Total Geo Survey </a>',
            zoomControl: true,
            maxzoom: 33,
            minzoom: 1,
	});
        var esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{
            attribution: 'WebGIS by &copy; <a href="https://totalgeosurvey.com/">PT Total Geo Survey </a>',
            zoomControl: true,
            maxZoom: 33,
            minZoom: 1,            
        }).addTo(map);
        var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
            attribution: 'WebGIS by &copy; <a href="https://totalgeosurvey.com/">PT Total Geo Survey </a>',
            zoomControl: true,
            maxZoom: 33,
            minZoom: 1,  
        });
        var carto = L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: 'WebGIS by &copy; <a href="https://totalgeosurvey.com/">PT Total Geo Survey </a>',
            zoomControl: true,
            maxZoom: 33,
            minZoom: 1,  
        });

        // Symbology + Action
	var kelurahan = 
        L.geoJSON(Kelurahan,{
            style: function(feature) {
                switch (feature.properties.NAME_3) {
                    case 'Danurejan': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Gedong Tengen': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Gondokusuman': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Gondomanan': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Jetis': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Kotagede': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Kraton': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Mantrijeron': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Mergangsan': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Ngampilan': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Pakualaman': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Tegalrejo': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Umbulharjo': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                    case 'Wirobrajan': return {color: "#000000", opacity: 0.5, fill: true, fillColor: "#bfbfbf", fillOpacity: 0.1};
                }
            },

            onEachFeature: function (feature, layer) {
                layer.bindPopup(
                'Kemantren' + '<br>' +
                '<strong>' +
                feature.properties.NAME_3 +
                '</strong><br><br>'+
                'Kelurahan' + '<br>' +
                '<strong>' +
                feature.properties.NAME_4 +
                '</strong><br><br>'+
                'Luas (Km^2)' + '<br>' +
                '<strong>' +
                feature.properties.Luas +
                '</strong>'
                );
            }
        }).addTo(map);
	    
        var bangunan = 
        L.geoJSON(bgnv02,{
            style: function(feature) {
                switch (feature.properties.remark) {
                    case 'Fungsi Hunian': return {
                        opacity: 0.8,
                        color: "rgba(35,35,35,1.0)",
                        dashArray: "",
                        lineCap: "butt",
                        lineJoin: "miter",
                        weight: 0.5,
                        fill: true,
                        fillOpacity: 0.8,
                        fillColor: "#ffff00",
                        interactive: true,
                    };
                    case 'Fungsi Keagamaan': return {
                        opacity: 0.8,
                        color: "rgba(35,35,35,1.0)",
                        dashArray: "",
                        lineCap: "butt",
                        lineJoin: "miter",
                        weight: 0.5,
                        fill: true,
                        fillOpacity: 0.8,
                        fillColor: "#5f005f",
                        interactive: true,
                    };
                    case 'Fungsi Usaha': return {
                        opacity: 0.8,
                        color: "rgba(35,35,35,1.0)",
                        dashArray: "",
                        lineCap: "butt",
                        lineJoin: "miter",
                        weight: 0.5,
                        fill: true,
                        fillOpacity: 0.8,
                        fillColor: "#ff4646",
                        interactive: true,
                    };
                    case 'Fungsi Sosial dan Budaya': return {
                        opacity: 0.8,
                        color: "rgba(35,35,35,1.0)",
                        dashArray: "",
                        lineCap: "butt",
                        lineJoin: "miter",
                        weight: 0.5,
                        fill: true,
                        fillOpacity: 0.8,
                        fillColor: "#9b9b9b",
                        interactive: true,
                    };
                    case 'Fungsi Khusus': return {
                        opacity: 0.8,
                        color: "rgba(35,35,35,1.0)",
                        dashArray: "",
                        lineCap: "butt",
                        lineJoin: "miter",
                        weight: 0.5,
                        fill: true,
                        fillOpacity: 0.8,
                        fillColor: "#9b00ff",
                        interactive: true,
                    };
                }
            },

            onEachFeature: function (feature, layer) {
                layer.bindPopup(
                'ID Bangunan' + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '<strong>' +
                feature.properties.id_reg + '.' + feature.properties.id_remark + '.' + feature.properties.id_obj +
                '</strong><br><br>'+
                'Fungsi Bangunan' + '&nbsp;&nbsp;&nbsp;' +
                '<strong>' +
                feature.properties.remark +
                '</strong><br><br>'+
                'Keterangan' + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '<strong>' +
                feature.properties.name +
                '</strong><br><br>'+
                'Berizin' + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '<strong>' +
                feature.properties.izin +
                '</strong><br><br>'+
                'Alamat' + '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' +
                '<strong>' +
                feature.properties.alamat +
                '</strong>'
                );
            }
        }).addTo(map);

	var jln = 
        L.geoJSON(jalan_merge,{
            style: function(feature) {
                switch (feature.properties.Material) {
                    case 'Jalan Aspal': return {color: "#ff0000", opacity: 0.1, fillOpacity: 0.5};
                }
            }
	}).addTo(map);

	// Map Legend
        var legend = L.control({position: 'bottomleft'});
        legend.onAdd = function (map) {
            var div = L.DomUtil.create('div', 'legend');
            div.innerHTML = '<strong>&nbsp;&nbsp;LEGENDA&nbsp;&nbsp;</strong><br>' +
                            '<div><span style="background-color: #ffff00; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Fungsi Hunian </div>' +
                            '<div><span style="background-color: #5f005f; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Fungsi Keagamaan </div>' +
		    	    '<div><span style="background-color: #ff4646; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Fungsi Usaha </div>' +
                            '<div><span style="background-color: #9b9b9b; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Fungsi Sosial dan Budaya </div>' +
		    	    '<div><span style="background-color: #9b00ff; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Fungsi Khusus </div>' +
		            '<div><span style="background-color: #ff0000; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Jaringan Jalan </div>' +
                            '<div><span style="background-color: #ffffff; border:black; text-align:left; width: 10px; height: 10px; display: inline-block;"></span> Batas Administrasi Kelurahan </div>';
            return div;
        };
        legend.addTo(map);
	    
        // Add Basemap
        var baseMaps = {
            "Aerial Imagery": real,
	    "Google Satellite": esri,
            "Open Street Map": osm,
            "Dark Canvas": carto
        };

        // Add Layer
        var overlay = {
            "<b>Batas Administrasi</b>": kelurahan,
	    "<b>Data Jalan</b>": jln,
	    "<b>Data Bangunan</b>": bangunan
        };
	    
        // Merge Layer & Basemap
        var controlLayers = L.control.layers(baseMaps, overlay).addTo(map);

	map.on('click', function(e){
        	console.log(e.latlng)
    	})

        // Add Scale	
	var graphicScale = L.control.graphicScale({
		fill: "fill",
		doubleLine: "true",
		showSubunits: "true"
	}).addTo(map);
    </script>

    <!-- Bootstrap Bill Turner -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous">
    </script>
</body>
</html>
